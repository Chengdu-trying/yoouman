<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>优漫</title>
		<link rel="stylesheet" href="css/bootstrap.css" />
		<link rel="stylesheet" href="css/shopping.css" />
		<link rel="stylesheet" href="css/hslider_style1.css" />
	</head>
	<style>
		#nav_{
			padding-left:50%;
			}
		#banner{
			text-align:left;
		}
		#top_{
			width:75%;
		}
	</style>

	<body>
		<div class="container" id="top_">
			<nav class="navbar navbar-default" id="nav_">
					<div class="row">
						<div>
						  <ul class="nav navbar-nav ">
							<li><a href="#">请登录 </a></li>
							
							<li><a href="Register.html" id="user_register">免费注册</a></li>
							 <li><a href="javascript:void(0);">收藏本店</a></li>
							 <li class="dropdown">
								<a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown">
									我的账户
								   <b class="caret"></b>
								</a>
								<ul class="dropdown-menu">
								   <li><a href="#">待付款订单</a></li>
								   <li><a href="#">已付款订单</a></li>
								   <li><a href="#">短消息</a></li>
								</ul>
							 </li>
							 <li><s></s><a href="shoppingList.jsp"><span class="gouwu"></span>购物车<span class="naber" id="cart_number">0</span>件</a>
							 </li>
							  <li class="fore"><s></s><a href="javascript:void(0)">收藏夹</a></li>			                  
						  </ul>
					   </div>				  	
					  </div>				  
					</nav>
					<div class="row" id="banner">
						<img src="images/logo.jpg.jpg" />
						 
					</div>
					<!--搜索-->
					<div class="row" style="padding-bottom:10px;">
						<div class="col-md-6 text-left">
							<div style="padding-top:6px;"> 热门搜索：<a href="#" class="label label-info">T恤</a>&nbsp;<a 	href="#" class="label label-info">帆布包</a>&nbsp;<a href="#" class="label label-info">公仔</a>&nbsp;<a href="#" class="label label-info">扇子</a>&nbsp;<a href="#" class="label label-info">卡贴</a>&nbsp;<a href="#" class="label label-info">手办</a>&nbsp;<a href="#" class="label label-info">海报</a>&nbsp;<a href="#" class="label label-info">同学录</a>
							</div> 			
						 </div>		 	
						 <div class="col-md-6">
								<div class="row" >				  				
										<table align="right" border="0px" cellspacing="0px" cellpadding="0px" width="80%">				  					
											<tr>
												<td>
													<span class="glyphicon glyphicon-search"></span>
												</td>
												<td>
													<input type="text" class="form-control " placeholder="请输入关键词搜索">
												</td>
												
												<td>
													<button type="button" class="btn btn-info">搜索</button>				  							
												</td>
											</tr>
										</table>				  			
								</div>
						 </div>			  	 
						</div>
				<ol class="breadcrumb text-left">
				  <li><a class="#">首页</a></li>
				  <li><a class="#">个人中心</a> </li>
				  <li type="active">商品列表</li>
				</ol>
			</div>
		<!--logo+导航-->
		<div id="logo">
			<div class="top">
				<div class="header" style="background:none">
					<a href="javascript:void(0);"></a>
				</div>
				<div class="navigation"></div>
			</div>

			<!--/*指示牌*/-->
			<div class="instructions">
				<p><span><a href="javascript:void(0);" target="_blank">关于发货的通知</a>&nbsp;&nbsp;</span>我的购物车</p>
			</div>

			<!--/*订单*/-->
			<!--订单发货-->
			<div id="shelf">
				<table width="980" height="40" border="0" cellspacing="0" id="myTableProduct">
					<tr>
						<td align="left" width="60" bgcolor="#fdeade" id="order_button">
							<span>
          						<input type="checkbox" value="" name="selectall" checked="checked" class="selectall">全选
							</span>
						</td>
						<td width="423" bgcolor="#fdeade" class="order_font">商品</td>
						<td width="164" bgcolor="#fdeade" class="order_font">单价（元）</td>

						<td width="110" bgcolor="#fdeade" class="order_font">数量（件）</td>
						<td width="106" bgcolor="#fdeade" class="order_font">小计</td>
						<td width="80" bgcolor="#fdeade" class="order_font">操作</td>
					</tr>
				</table>
			</div>

			<!--书本展示-->
			<form action="InsertOrdersServlet" method="post" id="myform" onkeypress="if(event.keyCode==13||event.which==13){return false;}">
				<div class="show">
					<div class="bookone" id="cart">

						<table width="957" border="0" cellspacing="0" class="cart" id="cartList">
							
						</table>

						<div style="clear:both;"></div>
					</div>
				</div>

				<!--继续购买-->
				<div class="buy">
					<table width="980" border="0" cellspacing="0">
						<tr>
							<td width="299">&nbsp;</td>
							<td width="425">&nbsp;</td>
							<td width="84">&nbsp;</td>
							<td width="164" height="63" id="price">
								<span class="span_1">商品金额</span>：<span class="span_2">￥<label id="totalPrice">0.00</label></span>
								<br>
								<span class="span_1">　　优惠</span>：<span class="span_2">- <label id="youhui">0.00</label></span>
							</td>
						</tr>

						<tr>
							<td>&nbsp;</td>
							<td height="46">&nbsp;</td>
							<td colspan="2" style=" border-top:1px solid  #fbccb0;">
								<span class="span_1">总金额（不含运费）：</span>
								<span class="span_2" style="font-size:24px;">￥
	        						<label id="totalPrices">0.00</label>
	        					</span>
								<input type="hidden" value="" name="totalPrices" id="totalPrices_hidden" />
							</td>
						</tr>

						<tr>
							<td bgcolor="#fdeade" style="padding-left:6px;" align="left">
								<a href="index.html"><img src="img\button2.jpg" width="92" height="24"></a>
							</td>
							<td height="40" colspan="2" bgcolor="#fdeade">&nbsp;</td>
							<td bgcolor="#fdeade" style="padding-left:35px;">
								<a href="javascript:void(0);" id="submit_button"><img src="img\button1.jpg" width="109" height="31"></a>
							</td>
						</tr>
					</table>
				</div>
			</form>

			<!--热销产品-->
			<div class="selling_big hsliber">
				<div class="selling_big_biao">热销商品</div>
				<s class="slide_control_l" style="display:none;"></s>
				<div id="hot">
					<ul class="selling">
						<li>
							<a class="productImg-wrap" style="background:url(img/55249faf6f934.jpg.150x150.jpg)" title="MK大海报·学院Pie" href="javascript:void(0);"></a>
							<h3 class="wenzhi"><a href="javascript:void(0);" title="MK大海报·学院Pie">MK大海报·学院Pie...</a></h3>
							<p>￥8.00</p>
						</li>
						<li>
							<a class="productImg-wrap" style="background:url(img/54ee974f129d6.jpg.150x150.jpg)" title="斗破苍穹手办[送独家心意卡]" href="javascript:void(0);"></a>
							<h3 class="wenzhi"><a href="javascript:void(0);" title="斗破苍穹手办[送独家心意卡]">斗破苍穹手办[送独家心...</a></h3>
							<p>￥39.00</p>
						</li>
						<li>
							<a class="productImg-wrap" style="background:url(img/54a212c181386.jpg.150x150.jpg)" title="烛天暖萌抱枕（可插手）" href="javascript:void(0);"></a>
							<h3 class="wenzhi"><a href="javascript:void(0);" title="烛天暖萌抱枕（可插手）">烛天暖萌抱枕（可插手...</a></h3>
							<p>￥68.00</p>
						</li>
						<li>
							<a class="productImg-wrap" style="background:url(img/541a4de0be294.jpg.150x150.jpg)" title="萌趣帆布包" href="javascript:void(0);"></a>
							<h3 class="wenzhi"><a href="javascript:void(0);" title="萌趣帆布包">萌趣帆布包...</a></h3>
							<p>￥88.00</p>
						</li>
						<li>
							<a class="productImg-wrap" style="background:url(img/53d613bc45dd7.jpg.150x150.jpg)" title="MK暴走邻家烛天毛绒公仔 特价" href="javascript:void(0);"></a>
							<h3 class="wenzhi"><a href="javascript:void(0);" title="MK暴走邻家烛天毛绒公仔 特价">MK暴走邻家烛天毛绒公...</a></h3>
							<p>￥60.00</p>
						</li>
						<li>
							<a class="productImg-wrap" style="background:url(img/537090cc25895.jpg.150x150.jpg)" title="MK8周年漫画短篇集" href="javascript:void(0);"></a>
							<h3 class="wenzhi"><a href="javascript:void(0);" title="MK8周年漫画短篇集">MK8周年漫画短篇集...</a></h3>
							<p>￥12.00</p>
						</li>
					</ul>
				</div>
				<b class="slide_control_r" style="display:none"></b>
				<div class="clear"></div>
			</div>
		</div>

		<!-- 底部 --->
		<iframe NAME="content_frame" width=100% frameborder=0 scrolling="no" height=200 marginwidth=0 marginheight=0 SRC="bottom.html"></iframe>

		<script type="text/javascript" src="js/jquery-1.9.1.js"></script>
		<script type="text/javascript" src="js/bootstrap.js"></script>

		<script type="text/javascript">
			$(document).ready(function() {
				
				
			});
			
			$.ajax({
	 			url:"shoppingCargetList.action",
	 			type:"POST",
	 			dataType:"json",
	 			success:function(data){
	 				var list=eval(data);
	 				var str_new="";
	 				for(var i=0;i<list.length;i++){
	 					str_new+="<tr><td width='10'><input type='checkbox' name='cart_id["+list[i].pId
                               	+"]' value="+list[i].pId
                               	+" checked='checked' class='check' /></td><td width='80'><a href='javascript:void(0);' target='_blank'><div class='baobei' style='background:url("+list[i].imgUrl
                       			+".50x50.jpg); cursor:pointer'></div></a></td><td width='353' id='goods_introduce'><em><a  href='GoodsInfoServlet?goods_id=${goods.goods_id }' target='_blank'>"+list[i].pName
 								+"<span class='reachName'></span><br><span style='color:#cccccc'>款式 :普通</span></a></em></td><td width='144'><p id='shopping_price'>￥<span id='shop_price_437134' class='goodsprice'>"+list[i].pPrice
 								+"</span></p></td><td width='111'><div class='tb'><a href='javascript:cut("+i+");' class='diminished'><img src='img/buy_20.jpg' width='24' height='24' /></a><input type='text' id='goods_"+list[i].pId
 								+"' value='1' class='goods_num' /><a href='javascript:add("+i+");' class='augmented'><img src='img/buy_22.jpg' width='24' height='24' /></a></div></td><td width='112' id='googs_price'>￥ <span id='subtotal_"+list[i].pId
 								+"' class='subtotal' data="+list[i].pId
 								+"></span></td><td width='57' id='shanchu'><a href='shoppingCardelete?productId="+list[i].pId
								+"' class='delete' data='"+list[i].pId
								+"'>删除</a></td></tr>";
	 				}
	 				$("#cartList").append(str_new);
	 				calcshopping();
	 			},
	 			error: function() {
					alert("获取出错！");
				}
	 		});
			
			//商品计算函数
			function calcshopping() {
				var shoppingTotal = 0;
				$("#cartList").find("tr").each(function(i, ele) {
					//商品数量
					var num = $(ele).find(".goods_num").val();
					var price_sigle = $(ele).find(".goodsprice").html() * num;
					//商品的价格累加
					shoppingTotal += price_sigle;
					//将值显示到页面上
					var a_b = price_sigle + "";
					var n_a = a_b.indexOf(".");
					$(ele).find(".subtotal").text(parseInt(price_sigle) + "." + a_b.substr(n_a + 1, 2));
				});
				var a_n = (shoppingTotal - parseInt(shoppingTotal)) + "";
				var n1 = a_n.indexOf(".");
				$("#youhui").text(parseInt(a_n) + "." + a_n.substr(n1 + 1, 2));
				$("#totalPrice").text(parseInt(shoppingTotal) + "." + a_n.substr(n1 + 1, 2));
				$("#totalPrices").text(parseInt(shoppingTotal) + ".00");
				$("#totalPrices_hidden").val(parseInt(shoppingTotal) + 8);
			};
			
			calcshopping();
			
			//修改数量
			$(".goods_num").blur(function() {
				var value = $(".goods_num").val();
				if ((value == "") || !(/^[0-9]*[1-9][0-9]*$/.test(value))) {
					alert("数量不能为空，且只能为正整数");
					$(this).val(1);
				}
				calcshopping();
			});
			
			function add(obj) {
				var num = $($(".goods_num").get(obj)).val();
				num++;
				if ((num == "") || !(/^[0-9]*[1-9][0-9]*$/.test(num))) {
					alert("数量不能为空，且只能为正整数");
					$($(".goods_num").get(obj)).val(1);
					return;
				}
				$($(".goods_num").get(obj)).val(num);
				calcshopping();
			};
			
			function cut(obj) {
				var num = $($(".goods_num").get(obj)).val();
				num--;
				if ((num == "") || !(/^[0-9]*[1-9][0-9]*$/.test(num))) {
					alert("数量不能为空，且只能为正整数");
					$($(".goods_num").get(obj)).val(1);
					return;
				}
				$($(".goods_num").get(obj)).val(num);
				calcshopping();
			};
			
			$("#submit_button").click(function() {
				$("#myform").action = "InsertOrdersServlet?totalPrices=" + $("#totalPrices_hidden").val();
				$("#myform").submit();
			});
		</script>

	</body>

</html>